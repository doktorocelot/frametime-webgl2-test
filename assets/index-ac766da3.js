var U=Object.defineProperty;var B=(r,t,e)=>t in r?U(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>(B(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class I extends Error{}function f(r){if(r==null)throw new I("Non-null assertion failed!")}var F=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function R(){var r=new F(16);return F!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function b(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function N(r,t,e){var i=t[0],s=t[1],n=t[2],a=t[3],m=t[4],d=t[5],p=t[6],A=t[7],E=t[8],v=t[9],P=t[10],x=t[11],T=t[12],w=t[13],_=t[14],y=t[15],l=e[0],h=e[1],g=e[2],c=e[3];return r[0]=l*i+h*m+g*E+c*T,r[1]=l*s+h*d+g*v+c*w,r[2]=l*n+h*p+g*P+c*_,r[3]=l*a+h*A+g*x+c*y,l=e[4],h=e[5],g=e[6],c=e[7],r[4]=l*i+h*m+g*E+c*T,r[5]=l*s+h*d+g*v+c*w,r[6]=l*n+h*p+g*P+c*_,r[7]=l*a+h*A+g*x+c*y,l=e[8],h=e[9],g=e[10],c=e[11],r[8]=l*i+h*m+g*E+c*T,r[9]=l*s+h*d+g*v+c*w,r[10]=l*n+h*p+g*P+c*_,r[11]=l*a+h*A+g*x+c*y,l=e[12],h=e[13],g=e[14],c=e[15],r[12]=l*i+h*m+g*E+c*T,r[13]=l*s+h*d+g*v+c*w,r[14]=l*n+h*p+g*P+c*_,r[15]=l*a+h*A+g*x+c*y,r}function D(r,t,e){var i=e[0],s=e[1],n=e[2],a,m,d,p,A,E,v,P,x,T,w,_;return t===r?(r[12]=t[0]*i+t[4]*s+t[8]*n+t[12],r[13]=t[1]*i+t[5]*s+t[9]*n+t[13],r[14]=t[2]*i+t[6]*s+t[10]*n+t[14],r[15]=t[3]*i+t[7]*s+t[11]*n+t[15]):(a=t[0],m=t[1],d=t[2],p=t[3],A=t[4],E=t[5],v=t[6],P=t[7],x=t[8],T=t[9],w=t[10],_=t[11],r[0]=a,r[1]=m,r[2]=d,r[3]=p,r[4]=A,r[5]=E,r[6]=v,r[7]=P,r[8]=x,r[9]=T,r[10]=w,r[11]=_,r[12]=a*i+A*s+x*n+t[12],r[13]=m*i+E*s+T*n+t[13],r[14]=d*i+v*s+w*n+t[14],r[15]=p*i+P*s+_*n+t[15]),r}function C(r,t,e,i,s,n,a){var m=1/(t-e),d=1/(i-s),p=1/(n-a);return r[0]=-2*m,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*p,r[11]=0,r[12]=(t+e)*m,r[13]=(s+i)*d,r[14]=(a+n)*p,r[15]=1,r}var j=C;class G{constructor(t,e){o(this,"verts");o(this,"xPos");o(this,"triCount");o(this,"fontAtlas");o(this,"gl");o(this,"vertBuffer");o(this,"vao");o(this,"modelMatrix",R());o(this,"projMatrix",R());o(this,"mvp",R());this.clear(),this.gl=t,this.fontAtlas=e;const i=t.createBuffer();f(i),t.bindBuffer(this.gl.ARRAY_BUFFER,i);const s=t.createVertexArray();f(s),t.bindVertexArray(s);const n=Float32Array.BYTES_PER_ELEMENT*4,a=this.gl.getAttribLocation(this.fontAtlas.program.glProgram,"position");this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,2,this.gl.FLOAT,!1,n,0);const m=this.gl.getAttribLocation(this.fontAtlas.program.glProgram,"st");this.gl.enableVertexAttribArray(m),this.gl.vertexAttribPointer(m,2,this.gl.FLOAT,!1,n,Float32Array.BYTES_PER_ELEMENT*2),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null),this.vertBuffer=i,this.vao=s}write(t){const e=t.length;for(let i=0;i<e;i++)this.fontAtlas.appendTrianglesForCharacter(t[i],this);this.updateBuffer()}clear(){this.verts=[],this.xPos=0,this.triCount=0}draw(){this.fontAtlas.bindState(),this.updateShaderMatrix(),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLES,0,this.triCount*3)}setLineFromTime(t){b(this.modelMatrix),this.modelMatrix=D(this.modelMatrix,this.modelMatrix,[0,L.height/L.PIXELS_PER_UNIT-this.fontAtlas.data.metrics.lineHeight*t,0])}setProjMatrix(t){this.projMatrix=t}updateShaderMatrix(){b(this.mvp);const t=this.gl.getUniformLocation(this.fontAtlas.program.glProgram,"u_mvp");f(t),this.fontAtlas.program.use(),N(this.mvp,this.projMatrix,this.modelMatrix),this.gl.uniformMatrix4fv(t,!1,this.mvp)}updateBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.verts),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}}class O{constructor(t,e,i){o(this,"gl");o(this,"glProgram");this.gl=t,this.glProgram=this.createAndLinkProgram(this.createAndCompileShader(e,t.VERTEX_SHADER),this.createAndCompileShader(i,t.FRAGMENT_SHADER))}use(){this.gl.useProgram(this.glProgram)}createAndCompileShader(t,e){const i=this.gl.createShader(e);if(f(i),this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error(`Unable to compile shader: ${this.gl.getShaderInfoLog(i)}`);return i}createAndLinkProgram(t,e){const i=this.gl.createProgram();if(f(i),this.gl.attachShader(i,t),this.gl.attachShader(i,e),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw new Error(`Unable to link program: ${this.gl.getProgramInfoLog(i)}`);return i}}const X=`#version 300 es\r
\r
precision mediump float;\r
\r
in vec2 position;\r
in vec2 st;\r
\r
uniform mat4 u_mvp;\r
uniform vec2 u_resolution;\r
\r
out vec2 fragSt;\r
\r
void main() {\r
    fragSt = st / u_resolution;\r
    gl_Position = u_mvp * vec4(position, 0.0, 1.0);\r
}`,Y=`#version 300 es\r
\r
precision mediump float;\r
\r
uniform vec2 u_resolution;\r
uniform sampler2D u_textureSampler;\r
\r
in vec2 fragSt;\r
\r
float median(float a, float b, float c) {\r
    return max(min(a, b), min(max(a, b), c));\r
}\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    vec3 s = texture(u_textureSampler, fragSt).rgb;\r
    float d = median(s.r, s.g, s.b) - 0.5;\r
    float w = clamp(d / fwidth(d) + 0.5, 0.0, 1.0);\r
    fragColor = vec4(1, 1, 1, w);\r
}\r
\r
`;class H{constructor(t,e,i){o(this,"glyphMap",new Map);o(this,"program");o(this,"data");o(this,"imgPath");o(this,"jsonPath");o(this,"image");o(this,"gl");o(this,"texture");o(this,"imgWidth",0);o(this,"imgHeight",0);this.imgPath=e,this.jsonPath=i,this.gl=t,this.texture=null,this.program=new O(t,X,Y)}bindState(){this.program.use(),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}async load(){await Promise.all([this.loadImage(),this.loadJson()]),f(this.image);const t=this.gl;this.program.use(),this.texture=t.createTexture(),this.gl.activeTexture(this.gl.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,this.image);const e=t.getUniformLocation(this.program.glProgram,"u_textureSampler");t.uniform1i(e,0);const i=t.getUniformLocation(this.program.glProgram,"u_resolution");t.uniform2f(i,this.imgWidth,this.imgHeight),t.bindTexture(t.TEXTURE_2D,null),t.useProgram(null)}loadImage(){return new Promise((t,e)=>{const i=new Image;i.onload=()=>{this.image=i,t()},i.onerror=s=>{e(s)},i.src=this.imgPath})}async loadJson(){const e=await(await fetch(this.jsonPath)).json(),i=e.glyphs,s=i.length;for(let n=0;n<s;n++){const a=i[n];this.glyphMap.set(a.unicode,a)}this.imgWidth=e.atlas.width,this.imgHeight=e.atlas.height,this.data=e}appendTrianglesForCharacter(t,e){const i=t.codePointAt(0);f(i);const s=this.glyphMap.get(i)??this.glyphMap.get(63);f(s);const n=s.planeBounds;if(n!=null){const a=s.atlasBounds,m=e.xPos,d=n.left+m,p=n.right+m;e.verts.push(d,n.bottom,a.left,a.bottom,p,n.bottom,a.right,a.bottom,d,n.top,a.left,a.top,d,n.top,a.left,a.top,p,n.bottom,a.right,a.bottom,p,n.top,a.right,a.top),e.triCount+=2}e.xPos+=s.advance}}var S=(r=>(r[r.DEBUG=0]="DEBUG",r))(S||{});const M=new Map;async function V(r,t,e,i){if(M.has(t))return;const s=new H(r,e,i);await s.load(),M.set(t,s)}function z(r){const t=M.get(r)??M.get(S.DEBUG);return f(t),t}const W="/assets/debug-font-173a85b4.png",q="/assets/debug-font-673d8cfd.json",u=class u{constructor(){o(this,"canvas");o(this,"gl");o(this,"group");o(this,"projMatrix2d");this.canvas=this.createCanvas();const t=this.canvas.getContext("webgl2");f(t),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this.gl=t,this.projMatrix2d=R(),window.addEventListener("resize",()=>this.resize()),this.resize(),document.body.appendChild(this.canvas)}async loadFont(t){await V(this.gl,t,W,q)}draw(t){const e=this.gl;if(e.clearColor(0,0,100,1),e.clear(e.COLOR_BUFFER_BIT),this.group==null){this.group=new G(e,z(S.DEBUG));return}e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.group.setLineFromTime(1),this.group.clear(),this.group.setProjMatrix(this.projMatrix2d),this.group.write(`Frame Time (ms): ${Math.round(t*1e5)/100}`),this.group.draw()}resize(){const t=window.innerWidth,e=window.innerHeight;this.canvas.width=t,this.canvas.height=e,this.gl.viewport(0,0,t,e),this.recalculateOrthoMatrix(t,e),u.width=t,u.height=e}recalculateOrthoMatrix(t,e){j(this.projMatrix2d,0,t/u.PIXELS_PER_UNIT,0,e/u.PIXELS_PER_UNIT,-1,1)}createCanvas(){const t=document.createElement("canvas");return t.width=3160,t.height=1200,t}};o(u,"PIXELS_PER_UNIT",14),o(u,"width",0),o(u,"height",0);let L=u;class J{constructor(){o(this,"renderer");o(this,"gameLoop_lastTimestampMillis",0);this.renderer=new L}startLoop(){this.renderer.loadFont(S.DEBUG).then(()=>{this.gameLoop_lastTimestampMillis=performance.now(),requestAnimationFrame(()=>this.loop())})}loop(){const t=performance.now(),e=(t-this.gameLoop_lastTimestampMillis)/1e3;this.renderer.draw(e),this.gameLoop_lastTimestampMillis=t,requestAnimationFrame(()=>this.loop())}}(async()=>new J().startLoop())();
